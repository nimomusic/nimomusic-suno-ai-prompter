<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NIMO MUSIC - Professional AI Music Engine</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #f8fafc; scroll-behavior: smooth; }
        .btn-active { background: #2563eb !important; color: white !important; box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3); }
        .animate-fade { animation: fadeIn 0.4s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        button:focus { outline: none; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        const encryptKey = (key) => btoa(key).split('').reverse().join('');
        const decryptKey = (enc) => atob(enc.split('').reverse().join(''));

        const SunoPromptGenerator = () => {
            const [language, setLanguage] = useState('ko');
            const [isGenerating, setIsGenerating] = useState(false);
            const [result, setResult] = useState(null);
            const [showSettings, setShowSettings] = useState(false);
            const [showHelp, setShowHelp] = useState(false);
            const [apiKey, setApiKey] = useState('');
            const [testStatus, setTestStatus] = useState('idle');
            
            const initialFormState = {
                genre: [], mood: [], vocal: [], instruments: [], mixing: [], theme: '', lyricsLanguage: 'ko'
            };
            const [formData, setFormData] = useState(initialFormState);

            const options = {
                genres: {
                    ko: ['발라드', '팝', '록', '일렉트로닉', '힙합', 'R&B', '재즈', '클래식', '포크', '인디', '컨트리', '블루스', '레게', '메탈', '펑크', '디스코', '소울', 'EDM', '하우스', '테크노', '트랜스', '덥스텝', '드럼 앤 베이스', '트랩', '보사노바', '플라멩코', '탱고', 'K-POP', 'J-POP', '시티팝', '신스팝', '뉴에이지', '앰비언트', '칠아웃', '로파이', '포스트록', '슈게이징', '인더스트리얼', '고스', '이모', '그런지', '펑크록', '하드록', '프로그레시브록'],
                    en: ['Ballad', 'Pop', 'Rock', 'Electronic', 'Hip-Hop', 'R&B', 'Jazz', 'Classical', 'Folk', 'Indie', 'Country', 'Blues', 'Reggae', 'Metal', 'Punk', 'Disco', 'Soul', 'EDM', 'House', 'Techno', 'Trance', 'Dubstep', 'Drum and Bass', 'Trap', 'Bossa Nova', 'Flamenco', 'Tango', 'K-POP', 'J-POP', 'City Pop', 'Synth-pop', 'New Age', 'Ambient', 'Chillout', 'Lo-fi', 'Post-rock', 'Shoegaze', 'Industrial', 'Goth', 'Emo', 'Grunge', 'Punk Rock', 'Hard Rock', 'Progressive Rock']
                },
                moods: {
                    ko: ['감성적인', '경쾌한', '우울한', '에너제틱', '로맨틱', '평화로운', '긴장감 있는', '희망적인', '신비로운', '강렬한', '따뜻한', '차가운', '몽환적인', '어두운', '밝은', '슬픈', '화난', '섹시한', '유쾌한', '멜랑콜리한', '향수를 자극하는', '웅장한', '섬세한', '거친', '부드러운', '극적인', '서정적인', '애절한', '장난스러운', '진지한', '반항적인', '고요한', '격정적인', '황홀한'],
                    en: ['Emotional', 'Upbeat', 'Melancholic', 'Energetic', 'Romantic', 'Peaceful', 'Tense', 'Hopeful', 'Mysterious', 'Intense', 'Warm', 'Cold', 'Dreamy', 'Dark', 'Bright', 'Sad', 'Angry', 'Sexy', 'Cheerful', 'Melancholy', 'Nostalgic', 'Epic', 'Delicate', 'Rough', 'Smooth', 'Dramatic', 'Lyrical', 'Heartbreaking', 'Playful', 'Serious', 'Rebellious', 'Serene', 'Passionate', 'Euphoric']
                },
                vocals: {
                    ko: ['남성 보컬', '여성 보컬', '남성 듀엣', '여성 듀엣', '남녀 듀엣', '혼성 합창', '남성 합창', '여성 합창', '어린이 합창', '아카펠라', '랩', '말하듯', '보컬 없음', '허밍', '휘파람', '비브라토', '가성', '하모니', '백그라운드 보컬'],
                    en: ['Male Vocal', 'Female Vocal', 'Male Duet', 'Female Duet', 'Mixed Duet', 'Mixed Choir', 'Male Choir', 'Female Choir', 'Children Choir', 'A Cappella', 'Rap', 'Spoken Word', 'No Vocal', 'Humming', 'Whistling', 'Vibrato', 'Falsetto', 'Harmony', 'Background Vocal']
                },
                instruments: {
                    ko: ['어쿠스틱 기타', '일렉트릭 기타', '베이스 기타', '피아노', '신시사이저', '드럼', '일렉트로닉 드럼', '첼로', '바이올린', '비올라', '더블베이스', '하프', '플루트', '색소폰', '트럼펫', '트롬본', '클라리넷', '하모니카', '아코디언', '밴조', '만돌린', '우쿨렐레', '타블라', '봉고', '콩가', '마림바', '오르간', '스트링 섹션', '브라스 섹션', '퍼커션', '808 베이스', '샘플링', '루프', '패드 사운드'],
                    en: ['acoustic guitar', 'electric guitar', 'bass guitar', 'piano', 'synthesizer', 'drums', 'electronic drums', 'cello', 'violin', 'viola', 'double bass', 'harp', 'flute', 'saxophone', 'trumpet', 'trombone', 'clarinet', 'harmonica', 'accordion', 'banjo', 'mandolin', 'ukulele', 'tabla', 'bongo', 'conga', 'marimba', 'organ', 'string section', 'brass section', 'percussion', '808 bass', 'sampling', 'loops', 'pad sounds']
                },
                mixingStyles: {
                    ko: ['가까이에서 들리는 듯', '시네마틱', '하이파이', '로파이', '빈티지', '모던', '비압축', '부드럽고 세련되게', '간결하고 명료하게', '입체감·풍부함', '공간적 분위기와 여운', '음량 고저 평탄화', '잔향 효과', '순수한 원음', '스테레오 와이드', '모노', '아날로그', '디지털', '불규칙한 소리', '찢어지는 듯한 음질', '클린', '거칠고 묵직한', '소리가 겹쳐진 듯한', '코러스', '딜레이', '에코', '프로덕션', '실험적', '대중적인'],
                    en: ['intimate', 'cinematic', 'high-fidelity', 'lo-fi', 'vintage', 'modern', 'raw', 'polished', 'minimalist', 'layered', 'ambient', 'compressed', 'reverb heavy', 'dry', 'stereo wide', 'mono', 'analog', 'digital', 'glitch', 'distortion', 'clean', 'crunch', 'phaser', 'chorus', 'delay', 'echo', 'production', 'experimental', 'mainstream']
                }
            };

            useEffect(() => {
                const saved = localStorage.getItem('_nimo_gemini_key');
                if (saved) setApiKey(decryptKey(saved));
            }, []);

            const resetOptions = (e) => {
                e.preventDefault();
                setFormData(initialFormState);
            };

            const toggleSelection = (e, field, value) => {
                e.preventDefault();
                setFormData(prev => ({
                    ...prev, [field]: prev[field].includes(value) ? prev[field].filter(v => v !== value) : [...prev[field], value]
                }));
            };

            const saveAndTestKey = async () => {
                setTestStatus('testing');
                try {
                    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-3-flash:generateContent?key=${apiKey}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ contents: [{ parts: [{ text: "hi" }] }] })
                    });
                    const data = await response.json();
                    if (data.error) throw new Error();
                    localStorage.setItem('_nimo_gemini_key', encryptKey(apiKey));
                    setTestStatus('success');
                    setTimeout(() => setShowSettings(false), 1000);
                } catch (e) { setTestStatus('fail'); }
            };

            const generatePrompt = async () => {
                const savedKey = localStorage.getItem('_nimo_gemini_key');
                if (!savedKey) { setShowSettings(true); return; }
                if (formData.genre.length === 0 || !formData.theme) { alert("장르와 테마를 입력하세요."); return; }

                setIsGenerating(true);
                const realKey = decryptKey(savedKey);

                try {
                    const res = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-3-flash:generateContent?key=${realKey}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            contents: [{ parts: [{ text: `Create a Suno AI v4 music prompt: ${JSON.stringify(formData)}. Language: ${formData.lyricsLanguage}.` }] }]
                        })
                    });
                    const data = await res.json();
                    setResult(data.candidates[0].content.parts[0].text);
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                } catch (err) { alert("API Error"); }
                finally { setIsGenerating(false); }
            };

            const RenderOptions = ({ label, field, list }) => (
                <div className="mb-10">
                    <div className="flex justify-between items-center mb-4">
                        <label className="text-[10px] font-black text-gray-400 uppercase tracking-widest italic">{label}</label>
                        {field === 'genre' && (
                            <button onClick={resetOptions} className="text-[10px] font-black text-red-400 hover:text-red-600 border border-red-100 px-3 py-1 rounded-full transition-all bg-red-50">
                                <i className="fa-solid fa-rotate-left mr-1"></i> RESET ALL
                            </button>
                        )}
                    </div>
                    <div className="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-2">
                        {list.map(val => (
                            <button key={val} onClick={(e) => toggleSelection(e, field, val)}
                                className={`px-3 py-2.5 rounded-xl text-[11px] font-bold transition-all border ${formData[field].includes(val) ? 'btn-active border-blue-600 scale-95' : 'bg-white text-gray-400 border-gray-100 hover:border-blue-200'}`}>
                                {val}
                            </button>
                        ))}
                    </div>
                </div>
            );

            return (
                <div className="min-h-screen pb-20 relative">
                    <header className="bg-white/80 backdrop-blur-md border-b sticky top-0 z-40">
                        <div className="max-w-7xl mx-auto px-6 py-4 flex justify-between items-center">
                            <div className="flex items-center gap-2 font-black italic text-xl tracking-tighter text-blue-600">
                                <i className="fa-solid fa-bolt-lightning"></i> NIMO MUSIC
                            </div>
                            <div className="flex gap-2">
                                <button onClick={() => setShowHelp(true)} className="px-4 py-2 rounded-full bg-blue-50 text-blue-600 text-[11px] font-black hover:bg-blue-100 transition-all flex items-center gap-2"><i className="fa-solid fa-circle-question"></i> HELP</button>
                                <button onClick={() => setShowSettings(true)} className="px-4 py-2 rounded-full bg-gray-100 hover:bg-gray-200 text-[11px] font-black flex items-center gap-2"><i className="fa-solid fa-key"></i> API SETTINGS</button>
                                <button onClick={() => setLanguage(l => l === 'ko' ? 'en' : 'ko')} className="w-10 h-10 rounded-full bg-black text-white text-[10px] font-black uppercase transition-transform active:scale-90">{language}</button>
                            </div>
                        </div>
                    </header>

                    <main className="max-w-6xl mx-auto px-6 py-10">
                        {!result ? (
                            <div className="bg-white rounded-[2.5rem] shadow-xl border p-8 md:p-12 animate-fade">
                                <RenderOptions label="장르 / GENRE" field="genre" list={options.genres[language]} />
                                <RenderOptions label="무드 / MOOD" field="mood" list={options.moods[language]} />
                                <RenderOptions label="보컬 / VOCAL" field="vocal" list={options.vocals[language]} />
                                <RenderOptions label="악기 / INSTRUMENTS" field="instruments" list={options.instruments[language]} />
                                <RenderOptions label="믹싱 / MIXING" field="mixing" list={options.mixingStyles[language]} />

                                <div className="grid md:grid-cols-2 gap-8 mb-12 border-t pt-10">
                                    <div>
                                        <label className="block text-[10px] font-black text-gray-400 uppercase tracking-widest mb-3 italic">가사 언어 / LYRICS LANGUAGE</label>
                                        <div className="flex gap-2">
                                            {['ko', 'en'].map(l => (
                                                <button key={l} onClick={(e) => {e.preventDefault(); setFormData({...formData, lyricsLanguage: l})}}
                                                    className={`flex-1 py-4 rounded-2xl font-black text-xs transition-all border ${formData.lyricsLanguage === l ? 'btn-active border-blue-600' : 'bg-gray-50 text-gray-400 border-gray-100'}`}>
                                                    {l === 'ko' ? 'KOREAN' : 'ENGLISH'}
                                                </button>
                                            ))}
                                        </div>
                                    </div>
                                    <div>
                                        <label className="block text-[10px] font-black text-gray-400 uppercase tracking-widest mb-3 italic">테마 / THEME & STORY</label>
                                        <textarea className="w-full p-5 bg-gray-50 border border-gray-100 rounded-2xl outline-none focus:ring-2 focus:ring-blue-500 h-[72px] font-medium text-sm" 
                                            placeholder="어떤 노래를 만들고 싶으신가요?" onChange={e => setFormData({...formData, theme: e.target.value})} />
                                    </div>
                                </div>

                                <button onClick={generatePrompt} disabled={isGenerating} 
                                    className="w-full py-6 bg-black text-white rounded-[2rem] font-black text-xl hover:bg-blue-600 transition-all shadow-xl flex items-center justify-center gap-4 active:scale-95 disabled:opacity-50">
                                    {isGenerating ? <i className="fa-solid fa-circle-notch animate-spin"></i> : <i className="fa-solid fa-wand-magic-sparkles"></i>}
                                    {isGenerating ? 'GENERATING...' : 'CREATE PROMPT'}
                                </button>
                            </div>
                        ) : (
                            <div className="bg-white rounded-[3rem] shadow-2xl border p-8 md:p-12 animate-fade">
                                <div className="flex justify-between items-center mb-8">
                                    <h2 className="text-2xl font-black italic tracking-tighter text-blue-600">SUCCESS!</h2>
                                    <div className="flex gap-2">
                                        <button onClick={() => {navigator.clipboard.writeText(result); alert('복사되었습니다!');}} className="bg-blue-50 text-blue-600 px-6 py-3 rounded-2xl font-black text-sm hover:bg-blue-100">COPY</button>
                                        <button onClick={() => setResult(null)} className="bg-gray-100 text-gray-600 px-6 py-3 rounded-2xl font-black text-sm">BACK</button>
                                    </div>
                                </div>
                                <pre className="bg-gray-900 text-blue-100 p-8 md:p-12 rounded-[2.5rem] whitespace-pre-wrap font-mono text-sm leading-relaxed border-[12px] border-gray-800 shadow-inner">
                                    {result}
                                </pre>
                            </div>
                        )}
                    </main>

                    {/* --- [도움말 모달 - 복구 완료] --- */}
                    {showHelp && (
                        <div className="fixed inset-0 z-50 flex items-center justify-center p-6 bg-black/70 backdrop-blur-md animate-fade">
                            <div className="bg-white rounded-[3rem] w-full max-w-lg p-10 shadow-2xl relative overflow-y-auto max-h-[90vh]">
                                <button onClick={() => setShowHelp(false)} className="absolute top-8 right-8 text-gray-300 hover:text-black"><i className="fa-solid fa-xmark text-2xl"></i></button>
                                <h3 className="text-2xl font-black italic tracking-tighter mb-8 text-blue-600 border-b pb-4">HELP GUIDE</h3>
                                <div className="space-y-8 text-sm">
                                    <section>
                                        <h4 className="font-black text-gray-900 mb-2 flex items-center gap-2 text-left">
                                            <span className="w-6 h-6 bg-black text-white rounded-full flex items-center justify-center text-[10px]">1</span>
                                            API 키 발급
                                        </h4>
                                        <p className="text-gray-500 ml-8 text-left"><a href="https://aistudio.google.com/app/apikey" target="_blank" className="text-blue-500 underline font-bold">여기</a>에 구글 계정으로 로그인 후 우측상단에 <b>API 키 만들기</b>를 클릭, 아래 <b>'가져온 프로젝트 선택'</b>의 아래 클릭 <b>'프로젝트 만들기'</b>선택, 이름 아무거나 작성 후 <b>만들기</b> 클릭, 오른쪽 <b>무료등급</b>과 <b>달러 표시</b> 사이 네모(<b>Copy API Key</b>) 클릭하면 API 키가 복사됨.</p>
                                    </section>
                                    <section>
                                        <h4 className="font-black text-gray-900 mb-2 flex items-center gap-2 text-left">
                                            <span className="w-6 h-6 bg-black text-white rounded-full flex items-center justify-center text-[10px]">2</span>
                                            설정 및 저장
                                        </h4>
                                        <p className="text-gray-500 ml-8 text-left">API키는 따로 잘 보관하시고 화면 상단 <b>API SETTINGS</b>를 눌러 API키를 붙여넣기하고 연결 테스트를 진행하세요.</p>
                                    </section>
                                    <section>
                                        <h4 className="font-black text-gray-900 mb-2 flex items-center gap-2 text-left">
                                            <span className="w-6 h-6 bg-black text-white rounded-full flex items-center justify-center text-[10px]">3</span>
                                            프롬프트 생성
                                        </h4>
                                        <p className="text-gray-500 ml-8 text-left">원하는 옵션을 선택하고 생성 버튼을 누르면 Suno AI용 결과가 완성됩니다!</p>
                                    </section>
                                </div>
                                <button onClick={() => setShowHelp(false)} className="w-full mt-10 py-5 bg-black text-white rounded-2xl font-black hover:bg-blue-600 transition-all">CLOSE</button>
                            </div>
                        </div>
                    )}

                    {/* --- [API 설정 모달] --- */}
                    {showSettings && (
                        <div className="fixed inset-0 z-50 flex items-center justify-center p-6 bg-black/60 backdrop-blur-sm animate-fade">
                            <div className="bg-white rounded-[3rem] w-full max-w-md p-10 shadow-2xl relative text-left">
                                <button onClick={() => setShowSettings(false)} className="absolute top-8 right-8 text-gray-300 hover:text-black"><i className="fa-solid fa-xmark text-2xl"></i></button>
                                <h3 className="text-2xl font-black italic tracking-tighter uppercase mb-8">Gemini Config</h3>
                                <input type="password" value={apiKey} onChange={e => setApiKey(e.target.value)} placeholder="API Key (AIzaSy...)" 
                                    className="w-full bg-gray-50 border-2 border-gray-100 rounded-2xl py-4 px-6 mb-6 focus:border-blue-500 outline-none font-mono text-sm" />
                                <button onClick={saveAndTestKey} className={`w-full py-5 rounded-2xl font-black text-white transition-all ${testStatus === 'success' ? 'bg-green-500' : 'bg-blue-600'}`}>
                                    {testStatus === 'testing' ? 'TESTING...' : testStatus === 'success' ? 'CONNECTED!' : 'SAVE & CONNECT'}
                                </button>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const App = () => {
            const [isAuth, setIsAuth] = useState(false);
            const [pw, setPw] = useState('');
            if (!isAuth) return (
                <div className="min-h-screen bg-black flex flex-col items-center justify-center text-white p-6">
                    <div className="max-w-md w-full space-y-10 text-center animate-fade">
                        <h1 className="text-6xl font-black italic tracking-tighter">NIMO MUSIC</h1>
                        <input type="password" value={pw} onChange={e => setPw(e.target.value)} placeholder="PASSWORD" 
                            className="w-full bg-white/10 border border-white/20 rounded-2xl py-6 text-center font-bold tracking-[1em] outline-none focus:border-blue-500" />
                        <button onClick={() => pw === 'nimo256' && setIsAuth(true)} className="w-full bg-white text-black py-6 rounded-2xl font-black text-lg hover:bg-blue-500 hover:text-white transition-all">ENTER</button>
                    </div>
                </div>
            );
            return <SunoPromptGenerator />;
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
