import React, { useState } from 'react';
import { 
  Copy, Music, Sparkles, Globe, RefreshCw, 
  ChevronDown, Lock, ArrowRight, Music2, Headphones 
} from 'lucide-react';

const SunoPromptGenerator = () => {
  const [language, setLanguage] = useState('ko');
  const [isGenerating, setIsGenerating] = useState(false);
  const [result, setResult] = useState(null);
  const [copySuccess, setCopySuccess] = useState(false);
  
  const [formData, setFormData] = useState({
    genre: [],
    mood: [],
    vocal: [],
    instruments: [],
    mixing: [],
    era: '',
    theme: '',
    additionalNotes: '',
    lyricsLanguage: 'ko'
  });

  // --- [데이터 옵션 영역] ---
  const options = {
    genres: {
      ko: ['어쿠스틱 발라드', '팝', '록', '일렉트로닉', '힙합', 'R&B', '재즈', '클래식', 'K-POP', '시티팝', '신스팝', '로파이'],
      en: ['Acoustic Ballad', 'Pop', 'Rock', 'Electronic', 'Hip-Hop', 'R&B', 'Jazz', 'Classical', 'K-POP', 'City Pop', 'Synth-pop', 'Lo-fi']
    },
    moods: {
      ko: ['감성적인', '경쾌한', '우울한', '에너제틱', '로맨틱', '평화로운', '몽환적인', '웅장한'],
      en: ['Emotional', 'Upbeat', 'Melancholic', 'Energetic', 'Romantic', 'Peaceful', 'Dreamy', 'Epic']
    },
    vocals: {
      ko: ['남성 보컬', '여성 보컬', '남녀 듀엣', '랩', '보컬 없음 (인스트루멘탈)', '팔세토'],
      en: ['Male Vocal', 'Female Vocal', 'Mixed Duet', 'Rap', 'No Vocal', 'Falsetto']
    },
    instruments: {
      ko: ['어쿠스틱 기타', '일렉트릭 기타', '피아노', '신시사이저', '드럼', '바이올린', '808 베이스'],
      en: ['Acoustic Guitar', 'Electric Guitar', 'Piano', 'Synthesizer', 'Drums', 'Violin', '808 Bass']
    },
    mixingStyles: {
      ko: ['인티메이트', '시네마틱', '하이파이', '로파이', '모던', '앰비언트'],
      en: ['Intimate', 'Cinematic', 'High-fidelity', 'Lo-fi', 'Modern', 'Ambient']
    },
    eras: {
      ko: ['1980년대', '1990년대', '2000년대', '2020년대', '미래적', '시대 무관'],
      en: ['1980s', '1990s', '2000s', '2020s', 'Futuristic', 'Timeless']
    }
  };

  const translations = {
    ko: {
      title: 'Suno AI 프롬프트 생성기',
      subtitle: 'v5 버전에 최적화된 전문 프롬프트를 생성합니다',
      genre: '장르', mood: '분위기', vocal: '보컬 타입', instruments: '악기', 
      mixing: '믹싱 스타일', era: '시대', lyricsLanguage: '가사 언어',
      generate: '프롬프트 생성', generating: '생성 중...', copyAll: '전체 복사',
      newPrompt: '새로운 프롬프트', required: '필수 항목을 선택해주세요.'
    },
    en: {
      title: 'Suno AI Prompt Generator',
      subtitle: 'Generate professional prompts optimized for v5',
      genre: 'Genre', mood: 'Mood', vocal: 'Vocal Type', instruments: 'Instruments',
      mixing: 'Mixing Style', era: 'Era', lyricsLanguage: 'Lyrics Language',
      generate: 'Generate Prompt', generating: 'Generating...', copyAll: 'Copy All',
      newPrompt: 'New Prompt', required: 'Please select required fields.'
    }
  };

  const t = translations[language];

  // --- [로직 영역] ---
  const toggleSelection = (field, value) => {
    setFormData(prev => {
      const currentArray = prev[field];
      if (currentArray.includes(value)) {
        return { ...prev, [field]: currentArray.filter(item => item !== value) };
      } else {
        return { ...prev, [field]: [...currentArray, value] };
      }
    });
  };

  const handleInputChange = (field, value) => {
    setFormData(prev => ({ ...prev, [field]: value }));
  };

  const generatePrompt = async () => {
    if (formData.genre.length === 0 && formData.theme === '') {
      alert(t.required);
      return;
    }
    setIsGenerating(true);
    
    // 시뮬레이션: 실제 API 연결 시 이 부분을 fetch 로직으로 대체하세요.
    setTimeout(() => {
      setResult(`[Title] ${formData.theme || "Generated Song"}\n\n[Style] ${formData.genre.join(", ")}, ${formData.mood.join(", ")}, ${formData.vocal.join(", ")}, ${formData.instruments.join(", ")}, ${formData.era}\n\n[Lyrics]\n[Intro]\n(Musical Introduction)\n\n[Verse 1]\n하늘 위로 흐르는 멜로디...`);
      setIsGenerating(false);
    }, 2000);
  };

  const copyToClipboard = () => {
    navigator.clipboard.writeText(result);
    setCopySuccess(true);
    setTimeout(() => setCopySuccess(false), 2000);
  };

  return (
    <div className="min-h-screen bg-gray-50 pb-12">
      <header className="bg-white border-b sticky top-0 z-10">
        <div className="max-w-6xl mx-auto px-6 py-4 flex items-center justify-between">
          <div className="flex items-center gap-3">
            <div className="w-10 h-10 bg-indigo-600 rounded-lg flex items-center justify-center text-white">
              <Music className="w-6 h-6" />
            </div>
            <h1 className="text-xl font-bold text-gray-900">{t.title}</h1>
          </div>
          <button onClick={() => setLanguage(language === 'ko' ? 'en' : 'ko')} className="text-sm font-semibold bg-gray-100 px-3 py-1 rounded-full">
            {language.toUpperCase()}
          </button>
        </div>
      </header>

      <main className="max-w-6xl mx-auto px-6 mt-8">
        {!result ? (
          <div className="bg-white rounded-2xl shadow-sm border p-8 space-y-8">
            {/* 장르 선택 영역 */}
            <div>
              <label className="block text-sm font-bold text-gray-700 mb-3">{t.genre}</label>
              <div className="flex flex-wrap gap-2">
                {options.genres[language].map(g => (
                  <button key={g} onClick={() => toggleSelection('genre', g)} 
                    className={`px-4 py-2 rounded-full text-xs transition-all ${formData.genre.includes(g) ? 'bg-indigo-600 text-white' : 'bg-gray-100 text-gray-600'}`}>
                    {g}
                  </button>
                ))}
              </div>
            </div>

            {/* 테마 입력 영역 */}
            <div>
              <label className="block text-sm font-bold text-gray-700 mb-3">곡의 주제/내용</label>
              <textarea 
                className="w-full border rounded-xl p-4 focus:ring-2 focus:ring-indigo-500 outline-none"
                placeholder="예: 비 오는 날의 그리움"
                onChange={(e) => handleInputChange('theme', e.target.value)}
              />
            </div>

            <button 
              onClick={generatePrompt}
              disabled={isGenerating}
              className="w-full py-4 bg-indigo-600 text-white rounded-xl font-bold hover:bg-indigo-700 transition-all flex items-center justify-center gap-2"
            >
              {isGenerating ? <RefreshCw className="animate-spin" /> : <Sparkles />}
              {isGenerating ? t.generating : t.generate}
            </button>
          </div>
        ) : (
          <div className="bg-white rounded-2xl shadow-sm border p-8">
            <div className="flex justify-between mb-4">
              <h2 className="text-lg font-bold">생성된 프롬프트</h2>
              <button onClick={copyToClipboard} className="flex items-center gap-1 text-indigo-600 font-medium">
                {copySuccess ? '복사됨!' : <><Copy size={16}/> 복사하기</>}
              </button>
            </div>
            <pre className="bg-gray-900 text-gray-100 p-6 rounded-xl overflow-x-auto whitespace-pre-wrap font-mono text-sm">
              {result}
            </pre>
            <button onClick={() => setResult(null)} className="mt-6 text-gray-500 underline text-sm w-full text-center">
              {t.newPrompt}
            </button>
          </div>
        )}
      </main>
    </div>
  );
};

// --- [메인 랜딩 & 암호 보호 컴포넌트] ---
export default function App() {
  const [isAuthorized, setIsAuthorized] = useState(false);
  const [password, setPassword] = useState('');
  const CORRECT_PASSWORD = 'nimo123'; // 지정된 암호

  const handleLogin = (e) => {
    e.preventDefault();
    if (password === CORRECT_PASSWORD) {
      setIsAuthorized(true);
    } else {
      alert('비밀번호가 틀렸습니다.');
    }
  };

  if (!isAuthorized) {
    return (
      <div className="min-h-screen bg-black flex flex-col items-center justify-center text-white px-4">
        {/* 장식용 배경 요소 */}
        <div className="absolute top-1/4 left-1/4 w-64 h-64 bg-indigo-900 rounded-full filter blur-[120px] opacity-30 animate-pulse"></div>
        <div className="absolute bottom-1/4 right-1/4 w-64 h-64 bg-purple-900 rounded-full filter blur-[120px] opacity-30 animate-pulse"></div>

        <div className="relative z-10 text-center space-y-8 max-w-md w-full">
          <div className="flex justify-center mb-4">
            <div className="p-4 bg-white/10 rounded-3xl backdrop-blur-md border border-white/20">
              <Music2 size={48} className="text-indigo-400" />
            </div>
          </div>
          
          <div className="space-y-2">
            <h1 className="text-4xl md:text-5xl font-black tracking-tighter italic">
              NIMO MUSIC
              <span className="block text-transparent bg-clip-text bg-gradient-to-r from-indigo-400 to-purple-400">
                SUNO AI PROMPTER
              </span>
            </h1>
            <p className="text-gray-400 text-sm font-light tracking-widest uppercase">
              Exclusive Creative Toolkit
            </p>
          </div>

          <form onSubmit={handleLogin} className="mt-12 space-y-4">
            <div className="relative group">
              <Lock className="absolute left-4 top-1/2 -translate-y-1/2 text-gray-500 group-focus-within:text-indigo-400 transition-colors" size={18} />
              <input 
                type="password" 
                value={password}
                onChange={(e) => setPassword(e.target.value)}
                placeholder="Enter Secret Password"
                className="w-full bg-white/5 border border-white/10 rounded-2xl py-4 pl-12 pr-4 outline-none focus:border-indigo-500/50 focus:bg-white/10 transition-all text-center tracking-widest"
              />
            </div>
            <button 
              type="submit"
              className="w-full bg-white text-black font-bold py-4 rounded-2xl hover:bg-indigo-400 hover:text-white transition-all flex items-center justify-center gap-2 group"
            >
              ACCESS PORTAL
              <ArrowRight size={18} className="group-hover:translate-x-1 transition-transform" />
            </button>
          </form>
          
          <div className="pt-8 flex justify-center gap-6 text-gray-600">
            <Headphones size={20} />
            <Sparkles size={20} />
            <Music size={20} />
          </div>
        </div>
      </div>
    );
  }

  return <SunoPromptGenerator />;
}
